# Generating Signature for API Requests

EnOS supports SHA-256 signature to help avoid malicious tampering and hacking attacks during API calling. An API request must carry a signature to be validated by the server side to be able to call an API. For Java SDKs, the signature algorithm is pre-built. If you use another programming language to call the APIs, you need to generate your own signature based on the application key, application secret, and request parameters.

## Syntax Description

Take the following steps to generate signature using the SHA-256 algorithm:

1. Sort parameters in the URL (including requestTimestamp) and application/x-www-form-urlencoded form parameters by ASCII order.

2. Concatenate the sorted parameters and their values into a string. For example:

   ```
   key1value1key2value2key3value3...keyNvalueN
   ```

3. If the request has JSON formatted request body, include the request body after the above string.

4. Add the accessKey as prefix to the concatenated string and the secretKey as the suffix. 

   ```
   <app_key><key1value1key2value2key3value3...keyNvalueN><app_secret>
   ```

5. Encode the concatenated string in UTF-8 format and make a digest by the signature algorithm (using SHA-256). After that, convert the digest to hexadecimal format.

## Example of Signature Generated by Java

```java
// Definition appKey and appSecret
String appkey = "eos_test_appkey";
String secret = "eos_test_secret";
String apiUrl = "http://eos.envisioncn.com/eeop";

// Parameter list
Map paramMap = new HashMap();
paramMap.put("mdmids", "67c17f7cebd44323b764e853394af5e8%2C70106f0c458e4b3994e741670d6be659");
paramMap.put("points", "INV.GenActivePW%2CINV.APProduction");
paramMap.put("time_group", "D");

// Arrange parameters by lexical order
String[] keyArray = paramMap.keySet().toArray(new String[0]);
Arrays.sort(keyArray);

// Splice the ordered parameter name-values
StringBuilder stringBuilder = new StringBuilder();
stringBuilder.append(appkey);
for (String key : keyArray)
{
    stringBuilder.append(key).append(paramMap.get(key));
}                 
stringBuilder.append(secret);
String codes = stringBuilder.toString();

// Example of string concatenation of the aforementioned parameters/AppKey/AppSecret after splicing:
// eos_test_appkeymdmids67c17f7cebd44323b764e853394af5e8%2C70106f0c458e4b3994e741670d6be659pointsINV.GenActivePW%2CINV.APProductiontime_groupDeos_test_secret

// Employ SHA-256 signature method here and convert to upper case
String sign = org.apache.commons.codec.digest.DigestUtils.shaHex(codes).toUpperCase();

//Signature result
//2D87E22205279651B59AD96AAEC102464374734F
```

## Troubleshooting Signature Validation Issues

If the error `signature verification failed` occurs while accessing an API, verify the following possible causes of the error and resolve the issue.

1.  Application key doesn't match application secret.
2.  Wrong signature method.
3.  When generating the sign signature, parameters are not propertly converted to UTF8 coding.

