# Signature algorithm

To avoid malicious tempering or usurp during API calling, the developer should generate the signature according to App Key, App Secret and request parameters, the Server side would validate the signature and a request without valid signature would be refused. So far, we support  SHA-1(sign_method=SHA) signature methods

## Algorithm description

1) Arrange all request parameters except appkey (including token, if token is available) by lexical ascending order;

2) Concatenate the  strings of the aforementioned ordered parameters, e.g. key1value1key2value2key3value3...keyNvalueN;

3) Take App Key as the prefix, and App Secret as the suffix, encode the string via utf-8 encoding, digest the encoded byte stream by signature algorithm, and convert into hexadecimal coding; EnOSâ„¢'s API Gateway provides us with the page for generating the signature algorithm, the user only needs to fill in the relevant parameters, and a corresponding sign signature would be generated.

##### Example of signature generated by JAVA

```java
// Definition appKey and appSecret
String appkey = "eos_test_appkey";
String secret = "eos_test_secret";
String apiUrl = "http://eos.envisioncn.com/eeop";

// Parameter list
Map paramMap = new HashMap();
paramMap.put("mdmids", "67c17f7cebd44323b764e853394af5e8%2C70106f0c458e4b3994e741670d6be659");
paramMap.put("points", "INV.GenActivePW%2CINV.APProduction");
paramMap.put("time_group", "D");

// Arrange parameters by lexical order
String[] keyArray = paramMap.keySet().toArray(new String[0]);
Arrays.sort(keyArray);

// Splice the ordered parameter name-values
StringBuilder stringBuilder = new StringBuilder();
stringBuilder.append(appkey);
for (String key : keyArray)
{
    stringBuilder.append(key).append(paramMap.get(key));
}                 
stringBuilder.append(secret);
String codes = stringBuilder.toString();

// Example of string concatenation of the aforementioned parameters/AppKey/AppSecret after splicing:
// eos_test_appkeymdmids67c17f7cebd44323b764e853394af5e8%2C70106f0c458e4b3994e741670d6be659pointsINV.GenActivePW%2CINV.APProductiontime_groupDeos_test_secret

// Employ SHA-1 signature method here and convert to upper case
String sign = org.apache.commons.codec.digest.DigestUtils.shaHex(codes).toUpperCase();

//Signature result
//2D87E22205279651B59AD96AAEC102464374734F
```

##### Attention:
If the error "signature verification failed" displays while accessing an API, the common causes are listed below:
```
1.  App Key doesn't match App Secret
2.  Wrong signature method
3.  When generating the sign signature, parameters in Chineses haven't been converted to UTF8 coding

```
